<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="./assets/logo.png" type="image/png" />
  <title>Podium</title>
  <style>
    @font-face {
      font-family: 'Pretendard-Bold';
      src: url('./fonts/Pretendard-Bold.ttf') format('truetype');
    }
    @font-face {
      font-family: 'Pretendard-Regular';
      src: url('./fonts/Pretendard-Regular.ttf') format('truetype');
    }
    @font-face {
      font-family: 'Pretendard-Light';
      src: url('./fonts/Pretendard-Light.ttf') format('truetype');
    }

    * {
      box-sizing: border-box;
      font-family: 'Pretendard-Regular', sans-serif;
    }

    body {
      margin: 0;
      background-color: #181818;
      color: white;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    .sidebar {
      width: 250px;
      background-color: #171717;
      border-right: 1px solid #000;
      padding: 16px;
      height: 100%;
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
      position: relative;
      z-index: 1000;
    }

    .sidebar.hidden {
      width: 0;
      padding: 0;
      overflow: hidden;
      transition: all 0.3s ease;
      opacity: 0;
    }

    .logo {
      display: flex;
      align-items: center;
      font-size: 15px;
      color: #D1D1D1;
      font-family: 'Pretendard-Light';
      margin-bottom: 24px;
      position: relative;
    }

    .sidebar .logo .sidebar-toggle-btn {
      position: absolute;
      top: 0;
      right: 0;
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
    }

    .new-btn {
      background-color: #171717;
      color: white;
      border: none;
      margin-bottom: 5px;
      width: 200px;
      min-width: 200px;
      padding: 10px 0;
      display: flex;
      align-items: center;
      font-size: 16px;
      text-align: left;
      cursor: pointer;
      border-radius: 4px;
      transition: background-color 0.3s ease;
    }

    .new-btn:hover {
      background-color: #2a2a2a;
    }

    .recents {
      flex-grow: 1;
      border-top: 0.5px solid #5E5E5E;
      padding-top: 8px;
      overflow-y: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .recents::-webkit-scrollbar {
      display: none;
    }

    .recents-title {
      font-size: 15px;
      color: #9D9D9D;
      margin-bottom: 8px;
      padding-left: 5px;
    }

    .recent-item {
      padding: 8px 12px;
      margin-bottom: 4px;
      border-radius: 4px;
      width: 200px;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      position: relative;
      cursor: pointer;
    }

    .recent-item:hover {
      background-color: #2a2a2a;
    }

    .more {
      display: none;
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #aaa;
      cursor: pointer;
    }

    .recent-item:hover .more {
      display: block;
    }
    .main {
        flex-grow: 1;
        padding: 40px;
        min-width: 300px;
        max-width: calc(100% - 300px);
        padding-top: 32px;
        overflow-y: auto;
        position: relative;
        margin: 0 auto;
      }
      
    #mainSidebarBtn {
        position: absolute;
        top: 15px;
        left: 0px;
        width: 50px;              /* ë²„íŠ¼ ë„ˆë¹„ */
        height: 50px;             /* ë²„íŠ¼ ë†’ì´ */
        padding: 0;
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        display: none;
        z-index: 1000;
        display: flex;
        align-items: flex-start;  /* ìˆ˜ì§ ìƒë‹¨ ì •ë ¬ */
        justify-content: flex-start; /* ìˆ˜í‰ ì¢Œì¸¡ ì •ë ¬ */
      }
    .title-input {
      background: none;
      border: none;
      outline: none;
      color: rgb(155, 155, 155);
      font-size: 18px;
      width: 100%;
      margin-bottom: 20px;
      font-family: 'Pretendard-SemiBold';
    }

    .content-area {
      background: none;
      border: none;
      outline: none;
      color: white;
      font-size: 30px;
      width: 100%;
      height: calc(100%-50px);
      resize: none;
      font-family: 'Pretendard-Light';
      line-height: 50px;
    }
    .content-area-custom {
        width: 100%;
        height: calc(100%-50px);
        padding: 0;
        font-size: 30px;
        font-family: 'Pretendard-Light';
        color: white;
        outline: none;
        background: none;
        overflow-y: auto;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      .content-area-custom div {
        margin-bottom: 60px; /* âœ… ê°„ê²© ì¤„ì´ê¸° */
        line-height: 40px;
      }

    .example-link {
      color: #aaa;
      text-decoration: underline;
      cursor: pointer;
      margin-top: 10px;
      display: inline-block;
      font-family: 'Pretendard-Regular';
    }

    .sidebar.hidden + .main .floating-title {
      left: 0;
    }
    .right-sidebar {
        top: 0;
        right: 0;
        width: 250px;
        min-width:180px ;
        height: 100%;
        background-color: #202020;
        border-left: 1px solid #333;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 999;
        transition: all 0.5s ease; /* âœ… ease-in ì¶”ê°€ */
        margin-left: auto; /* âœ… ì˜¤ë¥¸ìª½ ë ì •ë ¬ */
      }
      
      .right-sidebar.hidden {
        width: 70px;
        min-width:70px ;
        padding: 16px;
        overflow: hidden;
        transition: all 0.5s ease;
        margin-left: auto; 
      }

      #collapsedSidebar {
        top: 20px;
        right: 0;
        background-color: #2a2a2a;
        color: white;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 998;
      }
      
      #collapsedSidebar.hidden {
        display: none;
      }
      
      #rephraseBtn {
        background-color: #121212;
        color: white;
        border: none;
        font-size: 14px;
        border-radius: 4px;
        cursor: pointer;
        align-items: left;
        transition: all 0.5s ease; /* âœ… ease-in ì¶”ê°€ */
      }
        #rephraseBtn:hover {
            background-color: #2a2a2a;
        }
        #slideToggleBtn { 
            background-color: #121212;
            color: white;
            border: none;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.5s ease; /* âœ… ease-in ì¶”ê°€ */
          }
        #slideToggleBtn:hover {
            background-color: #2a2a2a;
          }
        .right-sidebar.hidden button:not(.close-btn):not(#presentationBtn):not(#rightsidebtn),
        .right-sidebar.hidden p.description,
        .right-sidebar.hidden div.description {
          opacity: 0;
          transform: translateX(20px);
          pointer-events: none;
        }
        #presentationBtn {
            display: flex;
            align-items: center;
            background-color: #F2F2F2;
            color: #111111;
            border: #4E4E4E 0.5px solid;
            padding: 10px;
            border: none;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
          }
          
          #presentationBtn:hover {
            background-color: #bdbdbd;
          }
          
          .right-sidebar.hidden #presentationBtn .label {
            display: none;
          }
          
      .close-btn{
        color: none;
        width:25px;
        height:25px;
        border: none;
        background: none;
        cursor: pointer;
        right: 10px;
      }
      
      .right-sidebar .description {
        font-size: 12px;
        color: #bbb;
        margin: 0;
      }
      
      #slideToggleBtn.active {
        background-color: white;
        color: black;
      }
      
      .slide-break {
        display: flex;                /* ì¶”ê°€ */
        align-items: center;         /* ìˆ˜ì§ ì •ë ¬ */
        justify-content: center;     /* ìˆ˜í‰ ì •ë ¬ */
        background-color: #EF2C22;
        color: white;
        padding: 8px 0;
        height: 80px;
        margin: 16px 0;
        border-radius: 4px;
        font-size: 25px;
        font-family: 'Pretendard-Medium';
      }
      
      .slide-hover {
        background-color: rgba(255, 0, 0, 0.1);
        height: 30px;
        margin: 8px 0;
        cursor: pointer;
      }
      .rightsidebar-toggle-btn{
        top: 15px;
        left: 0px;
        width: 40px;              /* ë²„íŠ¼ ë„ˆë¹„ */
        height: 40px;             /* ë²„íŠ¼ ë†’ì´ */
        padding: 0;
        background: none;
        border: none;
        cursor: pointer;
        display: flex;
      }
  </style>
</head>
<body>
  <div class="sidebar" id="sidebar">
    <div class="logo">
      <img src="./assets/logo.png" alt="logo" style="width:32px; height:32px; margin-right:10px;">
      Podium
      <button class="sidebar-toggle-btn" onclick="toggleSidebar()">
        <img src="./assets/closesidebar.png" alt="toggle sidebar" style="width: 30px; height: 30px;" />
      </button>
    </div>
    <button class="new-btn" onclick="createNewScript()">
        <img src="./assets/NewScript.png" alt="new" style="width:25px; height:25px; margin-right:10px; margin-left:5px;">
        ìƒˆë¡œìš´ ëŒ€ë³¸
      </button>
      <div class="recents" id="recents">
        <div class="recents-title">recents</div>
      </div>
    </div>
    <div class="main" id="main">
      <input class="title-input" id="titleInput" placeholder="Untitled" />
      <div id="editor" contenteditable="true" class="content-area-custom"></div>
      <div class="example-link" id="exampleLink" onclick="loadExample()">í™œìš© ì˜ˆì‹œ ë³´ê¸° . . .</div>
    </div>
    <button class="sidebar-toggle-btn" id="mainSidebarBtn" onclick="toggleSidebar()">
        <img src="./assets/sidebar.png" alt="toggle sidebar" style="width: 20px; height: 16px;" />
      </button>
      <div class="right-sidebar" id="rightSidebar">
        <button class="rightsidebar-toggle-btn" id="rightsidebtn" onclick="toggleRightSidebar()">
            <img src="./assets/rightsidebar.png" alt="toggle sidebar" style="width: 28px; height: 28px;" />
          </button>
        <button id="presentationBtn" onclick="goToPresentationMode()">
            <img src="./assets/presentation.png"style="width: 16px; height: 16px; margin-right:10px" class="icon" />
            <span style="min-width: 150px; text-align :center;" class="label">í”„ë¦¬ì  í…Œì´ì…˜ ëª¨ë“œ</span>
          </button>
        <div class="description" style="margin-top: 20px; font-size: 14px; font-family: 'Pretendard-Regular'; color: #D1D1D1; border-top: 1px solid #333; padding-top: 10px;">
            í¸ì§‘ê¸°
        </div>
        <button id="rephraseBtn">
          <p style="min-width: 100px; text-align :center">
            ë¬¸ì¥ ì •ë¦¬í•˜ê¸°
            </p>
        </button>
        <p style="min-width: 100px;"class="description">ì½ê¸° ì‰¬ìš´ ëŒ€ë³¸ìœ¼ë¡œ ì •ë¦¬í•´ë“œë¦´ê²Œìš”</p>
        <button id="slideToggleBtn" onclick="toggleSlideMode()">
            <p style="min-width: 140px; text-align :center">
                ìŠ¬ë¼ì´ë“œ êµ¬ë¶„ ì‚½ì…
            </p>
        </button>
        <p style="min-width: 100px;"id="slideHint" class="description">ëŒ€ë³¸ì— ìŠ¬ë¼ì´ë“œ ë„˜ê¹€ ìœ„ì¹˜ë¥¼ í‘œì‹œí•´ë³´ì„¸ìš”</p>
      </div>  
    <script>
      let currentId = null;
      let currentScriptId = null;

      function updateSidebarVisibility() {
        const sidebar = document.getElementById('sidebar');
        if (window.innerWidth <= 768) {
            toggleSidebar() 
        }
      }

      function scriptData() {
        return JSON.parse(localStorage.getItem('scripts') || '{}');
      }

      function goToPresentationMode() {
        if (!currentScriptId) {
          alert('ëŒ€ë³¸ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
          return;
        }
      
        localStorage.setItem('presentationTarget', JSON.stringify({
          id: currentScriptId
        }));
      
        window.open('presentation.html', '_blank');
      }
  
      function saveToLocalStorage(id, title, contents) {
        const data = JSON.parse(localStorage.getItem('scripts') || '{}');
        data[id] = { title, contents };
        localStorage.setItem('scripts', JSON.stringify(data));
        renderRecents();
      }
  
      function createNewScript() {
        const id = Date.now().toString();
        currentId = id;
        currentScriptId = id;
        saveToLocalStorage(id, '', ['']);
        document.getElementById('titleInput').value = '';
        document.getElementById('editor').innerHTML = '';
        const editor = document.getElementById('editor');
        if (editor.innerHTML.trim() === '') {
            const line = document.createElement('div');
            line.innerHTML = '<br>'
            editor.appendChild(line);
        }
        checkExampleVisibility();
        ensureInitialLineAndFocus(); // âœ… ì¶”ê°€
      }
  
      function renderRecents() {
        const recents = document.getElementById('recents');
        recents.innerHTML = '<div class="recents-title">Recents</div>';
        const data = JSON.parse(localStorage.getItem('scripts') || '{}');
        const entries = Object.entries(data).sort((a, b) => b[0] - a[0]);
        for (const [id, script] of entries) {
          const div = document.createElement('div');
          div.className = 'recent-item';
          div.innerText = script.title || 'Untitled';
          div.onclick = () => loadScript(id);
          const more = document.createElement('button');
          more.className = 'more';
          more.innerText = 'â‹®';
          more.onclick = (e) => {
            e.stopPropagation();
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
              deleteScript(id);
            }
          };
          div.appendChild(more);
          recents.appendChild(div);
        }
      }
  
      function deleteScript(id) {
        const data = JSON.parse(localStorage.getItem('scripts') || '{}');
        delete data[id];
        localStorage.setItem('scripts', JSON.stringify(data));
        renderRecents();
      }
  
      function loadScript(id) {
        const data = JSON.parse(localStorage.getItem('scripts') || '{}');
        const script = data[id];
        if (script) {
          currentId = id;
          currentScriptId = id;
          document.getElementById('titleInput').value = script.title;
      
          const html = script.contents.map((line, idx) => {
            if (typeof line === 'number') {
              if (line === 1) {
                return `<div class="slide-break" data-index="${idx}" contenteditable="false">ë‹¤ìŒ ìŠ¬ë¼ì´ë“œ</div>`;
              }
              return ''; // 0ì€ ë Œë”ë§ ì•ˆí•¨
            }
            return `<div>${line}</div>`;
          }).join('');
      
          document.getElementById('editor').innerHTML = html;
      
          // ìŠ¬ë¼ì´ë“œ í´ë¦­ ì‹œ ì‚­ì œ ì²˜ë¦¬
          document.querySelectorAll('.slide-break').forEach(el => {
            el.addEventListener('click', (e) => {
              if (!isSlideMode) return; // ìŠ¬ë¼ì´ë“œ ëª¨ë“œì—ì„œë§Œ ì‘ë™
              const idx = Number(el.getAttribute('data-index'));
              toggleSlideBreak(idx);
            });
          });
        }
      
        checkExampleVisibility();
        ensureInitialLineAndFocus();
      }
      
      
      function handleContentInput() {
        const editor = document.getElementById('editor');
        const divs = Array.from(editor.children);
        const newContents = [];
      
        for (let i = 0; i < divs.length; i++) {
          const div = divs[i];
      
          if (div.classList.contains('slide-break')) {
            newContents.push(1);
          } else {
            const text = div.innerText.trim();
            if (text !== '') {
              newContents.push(text);
              const next = divs[i + 1];
              if (!next || !next.classList.contains('slide-break')) {
                newContents.push(0);
              }
            }
          }
        }
      
        const title = document.getElementById('titleInput').value;
        if (currentId) {
          saveToLocalStorage(currentId, title, newContents);
        }
      
        checkExampleVisibility();
      }
      
      function loadExample() {
        const example = {
          title: 'ìŠ¤íƒ€ë²…ìŠ¤ëŠ” ì™œ ë¹„ì‹¸ë„ ì˜ íŒ”ë¦´ê¹Œ?',
          contents: [
            'ì•ˆë…•í•˜ì„¸ìš”. ì €í¬ëŠ” ì˜¤ëŠ˜ "ìŠ¤íƒ€ë²…ìŠ¤ëŠ” ì™œ ë¹„ì‹¸ë„ ì˜ íŒ”ë¦´ê¹Œ?"ë¼ëŠ” ì£¼ì œë¡œ ë°œí‘œë¥¼ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.',
            1,
            'í˜¹ì‹œ ì—¬ëŸ¬ë¶„, ìŠ¤íƒ€ë²…ìŠ¤ ì»¤í”¼ ê°€ê²©ì´ í‰ê·  5ì²œ ì›ì´ ë„˜ëŠ”ë‹¤ëŠ” ì‚¬ì‹¤ ì•Œê³  ê³„ì…¨ë‚˜ìš”?',
            0,
            'ê·¸ëŸ°ë°ë„ í•­ìƒ ë§¤ì¥ì€ ë¶ë¹•ë‹ˆë‹¤.',
            0,
            'ìš°ë¦¬ëŠ” ë‹¨ìˆœíˆ "ë¸Œëœë“œë‹ˆê¹Œ"ë¼ê³  ë„˜ê¸¸ ìˆ˜ë„ ìˆì§€ë§Œ,',
            0,
            'ê·¸ ì´ë©´ì—ëŠ” ì •êµí•œ í”„ë¦¬ë¯¸ì—„ ì „ëµì´ ìˆ¨ì–´ìˆìŠµë‹ˆë‹¤.',
            0,
            'ì˜¤ëŠ˜ì€ ì´ ì „ëµì„ ë§ˆì¼€íŒ… ê´€ì ì—ì„œ ë¶„ì„í•´ë³´ê² ìŠµë‹ˆë‹¤.',
            1,
            'ìŠ¤íƒ€ë²…ìŠ¤ëŠ” ë‹¨ìˆœíˆ ì»¤í”¼ë¥¼ íŒŒëŠ” ë¸Œëœë“œê°€ ì•„ë‹™ë‹ˆë‹¤.',
            1,
            'ìŠ¤íƒ€ë²…ìŠ¤ëŠ” â€˜ê²½í—˜â€™ì„ íŒë‹ˆë‹¤.',
            1,
            'ë§¤ì¥ ì¸í…Œë¦¬ì–´, ê³ ê° ì´ë¦„ì„ ë¶ˆëŸ¬ì£¼ëŠ” ë¬¸í™”, ê°œì¸ ë§ì¶¤ ìŒë£Œ ë“±ì€ ê³ ê°ì—ê²Œ',
            0,
            'â€˜ë‚˜ë§Œì„ ìœ„í•œ ì„œë¹„ìŠ¤â€™ë¼ëŠ” ëŠë‚Œì„ ì¤ë‹ˆë‹¤.',
            0,
            'ì´ê±´ ë‹¨ìˆœíˆ ì œí’ˆì´ ì•„ë‹Œ ê²½í—˜ ê°€ì¹˜ë¥¼',
            0,
            'ì¤‘ì‹¬ìœ¼ë¡œ í•œ í”„ë¦¬ë¯¸ì—„ ì „ëµì…ë‹ˆë‹¤.',
            0
          ]
        };
      
        const id = 'example_' + Date.now();
        currentId = id;
        currentScriptId = id;
        saveToLocalStorage(id, example.title, example.contents);
        document.getElementById('titleInput').value = example.title;
      
        const html = example.contents.map((line, idx) => {
          if (typeof line === 'number') {
            if (line === 1) {
              return `<div class="slide-break" data-index="${idx}" contenteditable="${isSlideMode ? 'false' : 'true'}">ë‹¤ìŒ ìŠ¬ë¼ì´ë“œ</div>`;
            }
            return '';
          }
          return `<div>${line}</div>`;
        }).join('');
      
        document.getElementById('editor').innerHTML = html;
      
        // ğŸ‘‡ ìŠ¬ë¼ì´ë“œ ë„˜ê¹€ í´ë¦­ ì‹œ ì œê±° ë™ì‘ ì¶”ê°€
        document.querySelectorAll('.slide-break').forEach(el => {
          el.addEventListener('click', (e) => {
            if (!isSlideMode) return; // ìŠ¬ë¼ì´ë“œ ëª¨ë“œì—ì„œë§Œ ì‚­ì œ ê°€ëŠ¥
            const idx = Number(el.getAttribute('data-index'));
            toggleSlideBreak(idx);
          });
        });
      
        checkExampleVisibility();
      }      

      function toggleSlideBreak(index) {
        const scripts = scriptData();
        const script = scripts[currentScriptId];
        if (!script || !Array.isArray(script.contents)) return;
      
        if (script.contents[index] === 1) {
          script.contents[index] = 0;
          localStorage.setItem('scripts', JSON.stringify(scripts));
          loadScript(currentScriptId); // ë‹¤ì‹œ ê·¸ë¦¬ê¸°
          if (isSlideMode) showSlideInsertZones();
        }
      }
      
      
      function checkExampleVisibility() {
        const editor = document.getElementById('editor');
        const hasText = editor.innerText.trim().length > 0;
        document.getElementById('exampleLink').style.display = hasText ? 'none' : 'inline-block';
      }
  
      document.getElementById('titleInput').addEventListener('input', () => {
        handleContentInput();
      });
  
      document.getElementById('editor').addEventListener('input', () => {
        handleContentInput();
      });
  
      function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const mainSidebarBtn = document.getElementById('mainSidebarBtn');
        sidebar.classList.toggle('hidden');
        mainSidebarBtn.style.display = sidebar.classList.contains('hidden') ? 'block' : 'none';
      }
  
      function scrollToTop() {
        document.getElementById('main').scrollTo({ top: 0, behavior: 'smooth' });
      }
  
      window.addEventListener('DOMContentLoaded', () => {
        document.getElementById('mainSidebarBtn').style.display = 'none';
        renderRecents();
        createNewScript();
        ensureInitialLineAndFocus();
        updateSidebarVisibility();
      });
      
      function toggleRightSidebar() {
        const sidebar = document.getElementById('rightSidebar');
        const isHidden = sidebar.classList.toggle('hidden');
        
        // ìŠ¬ë¼ì´ë“œ ëª¨ë“œ ë¹„í™œì„±í™” ì‹œ break í¸ì§‘ í—ˆìš©
        if (!isHidden && !isSlideMode) {
          Array.from(document.getElementsByClassName('slide-break')).forEach(e => {
            e.contentEditable = 'true';
          });
        }
      }
            
      let isSlideMode = false;

      function toggleSlideMode() {
        isSlideMode = !isSlideMode;
        updateEditorEditableState()
        const btn = document.getElementById('slideToggleBtn');
        const label = btn.querySelector('p'); // ë‚´ë¶€ í…ìŠ¤íŠ¸ ìš”ì†Œ
        const hint = document.getElementById('slideHint');
      
        if (isSlideMode) {
          btn.classList.add('active');
          if (label) label.innerText = 'í‘œì‹œí•  ìœ„ì¹˜ ì„ íƒ ì¤‘â€¦';
          if (hint) hint.innerText = 'ë‹¤ìŒ ìŠ¬ë¼ì´ë“œë¡œ ë„˜ì–´ê°ˆ ìœ„ì¹˜ë¥¼ í´ë¦­í•´ í‘œì‹œí•´ë³´ì„¸ìš”';
          showSlideInsertZones();
      
          // break í¸ì§‘ ë§‰ê¸°
          Array.from(document.getElementsByClassName('slide-break')).forEach(e => {
            e.contentEditable = 'false';
          });
        } else {
          btn.classList.remove('active');
          if (label) label.innerText = 'ìŠ¬ë¼ì´ë“œ ë„˜ê¹€ í‘œì‹œí•˜ê¸°';
          if (hint) hint.innerText = 'ëŒ€ë³¸ì— ìŠ¬ë¼ì´ë“œ ë„˜ê¹€ ìœ„ì¹˜ë¥¼ í‘œì‹œí•´ë³´ì„¸ìš”';
          removeSlideInsertZones();
      
          // break í¸ì§‘ í—ˆìš©
          Array.from(document.getElementsByClassName('slide-break')).forEach(e => {
            e.contentEditable = 'true';
          });
        }
      }
      function updateEditorEditableState() {
        const editor = document.getElementById('editor');
        editor.setAttribute('contenteditable', isSlideMode ? 'false' : 'true');
      }
      
      function showSlideInsertZones() {
        const editor = document.getElementById('editor');
        const children = Array.from(editor.children);
        const script = JSON.parse(localStorage.getItem('scripts') || '{}')[currentScriptId];
      
        // ê¸°ì¡´ hover ëª¨ë‘ ì œê±°
        removeSlideInsertZones();
      
        if (!script || !Array.isArray(script.contents)) return;
      
        let visualIndex = 0;
      
        for (let i = 0; i < script.contents.length; i++) {
          if (script.contents[i] === 0) {
            const spacer = document.createElement('div');
            spacer.className = 'slide-hover';
            spacer.addEventListener('click', (e) => {
              e.stopPropagation();
              script.contents[i] = 1; // 0ì„ 1ë¡œ ë°”ê¿” ìŠ¬ë¼ì´ë“œ í‘œì‹œ
              localStorage.setItem('scripts', JSON.stringify({ ...scriptData(), [currentScriptId]: script }));
              loadScript(currentScriptId); // ìƒˆë¡œ ë Œë”ë§
              if (isSlideMode) showSlideInsertZones(); // ë‹¤ì‹œ hover ë³µì›
            });
      
            // children[visualIndex] ì•ì— ë„£ìŒ
            const target = children[visualIndex];
            if (target) {
              editor.insertBefore(spacer, target);
            } else {
              editor.appendChild(spacer);
            }
          } else {
            visualIndex++; // 0ì´ ì•„ë‹Œ ê²½ìš° ì‹¤ì œ divê°€ í•˜ë‚˜ ë Œë”ë§ë˜ì—ˆìŒ
          }
        }
      }
      
      
      function removeSlideInsertZones() {
        const editor = document.getElementById('editor');
        Array.from(editor.getElementsByClassName('slide-hover')).forEach(e => e.remove());
      }
      

      function insertSlideBreak(index) {
        const editor = document.getElementById('editor');
        const script = JSON.parse(localStorage.getItem('scripts') || '{}')[currentScriptId];
        if (!script || !Array.isArray(script.contents)) return;
      
        // slide-break ì‚½ì…/ì œê±°ëŠ” ë°ì´í„°ì—ì„œ ì²˜ë¦¬
        if (typeof script.contents[index] === 'number') {
          // 1ì´ë©´ â†’ 0ìœ¼ë¡œ ë°”ê¿ˆ (ìŠ¬ë¼ì´ë“œ ì œê±°)
          script.contents[index] = 0;
        } else {
          // ê¸°ì¡´ ë¬¸ìì—´ ì‚¬ì´ì— ì—†ëŠ” ê²½ìš° â†’ 1ì„ ë¼ì›Œ ë„£ìŒ
          script.contents.splice(index, 0, 1);
        }
      
        // ì €ì¥ ë° ë‹¤ì‹œ ë Œë”ë§
        const allScripts = JSON.parse(localStorage.getItem('scripts') || '{}');
        allScripts[currentScriptId] = script;
        localStorage.setItem('scripts', JSON.stringify(allScripts));
      
        loadScript(currentScriptId); // ìƒˆë¡œ ë Œë”ë§
        if (isSlideMode) showSlideInsertZones(); // hover ë³µì›
      }
      
  
      const main = document.getElementById('main');
      const titleInput = document.getElementById('titleInput');
      const floatingTitle = document.getElementById('floatingTitle');

      function ensureInitialLineAndFocus() {
        const editor = document.getElementById('editor');
        if (editor.innerHTML.trim() === '') {
            const line = document.createElement('div');
            line.innerHTML = '<br>'
            editor.appendChild(line);
        }
        // í¬ì»¤ìŠ¤ ì„¤ì •
        editor.focus();
        const range = document.createRange();
        const sel = window.getSelection();
        const lastLine = editor.lastChild;
        range.setStart(lastLine, 0);
        range.collapse(true);
        sel.removeAllRanges();
        sel.addRange(range);
      }

    </script>
  </body>
  </html>
